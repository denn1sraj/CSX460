---
title: "Assingment NYC Flight Data"
author: "Dennis Raj"
date: "April 11, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## NYC Flight Data

Your job is to create a "rectangular" table useful for modeling from flight data. 
In the folder `02-fundamentals/data` there are four CSV files: `flights.csv`, 
`airports.csv`, `planes.csv` and `weather.csv`.  Join/merge these tables such 
that there is one rectangular table with one row for each flight. 


Put code in each of the sections provided.

## 1. Read Data

Using the `readr` package read the `flights` data.

```{r}
library(readr) # import the library reader note - use install.packages("readr") if not installed
# create a data table using read_csv from readr
# if working directory does not have data/flights change "data/flights.csv" to correct directory
flights.df <- read_csv("data/flights.csv", col_types = cols(
                         day = col_character(),      #import day is character string 
                         month = col_character(),    #import day is character string 
                         year = col_character()      #import day is character string 
                         )
                       )
spec(flights.df)           #double checking that year / month / day have been imported as a string 

```

## Numeric Variables  

Plot a histogram of arrival delays and departure delays 

```{r}
attach(flights.df) # attach the data frame flights.df
opar <- par(no.readonly=TRUE) # Make a copy of the current settings
par(mfcol = c(2, 1))  # set the graph up to display side by side histograms 
                      # for arrival and departure delay
hist(arr_delay)
hist(dep_delay)
detach(flights.df)
par(opar)

```

## Scatterplot

Plot a scatterplot of date vs arrival delay 

```{r}
library(stringr)
library(dplyr)
flights.df <- mutate(flights.df, fdate = str_c(flights.df$year, flights.df$month, flights.df$day, sep = "-"))
flights.df <- mutate(flights.df, fdate = as.Date(fdate, format = "%Y-%m-%d"))
attach(flights.df)
plot(fdate, arr_delay, 
     ylim = range (-100:1100)
     )
detach(flights.df)
```



## Create tables for Categorical Variables

Create a `table`, counting the flights by origin airports and carrier.

```{r}
library(dplyr)
options(dplyr.width = Inf)
g <- group_by(flights.df, origin, carrier)
x <- count(g)
View(x)
```


## Join Data

**Read** in the other data sets. Use methods to join the data together to create a single table containing one record per row.  (HINT: see `?data.table` or `?dplyr::join`)

```{r}
library(readr)
airports.df <- read_csv("data/airports.csv")
planes.df <- read_csv("data/planes.csv")
weather.df <- read_csv("data/weather.csv")

library(dplyr)
final.df <- left_join(flights.df, planes.df, by = "tailnum")
final.df <- left_join(final.df, airports.df, by = c("origin" = "faa"))
final.df <- left_join(final.df, weather.df, by = c("origin" = "origin", "time_hour" = "time_hour"))
glimpse(final.df)
```



