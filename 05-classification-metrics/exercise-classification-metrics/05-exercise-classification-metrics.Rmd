---
title: "Classification Mettrics"
author: "Christopher Brown"
date: "October 5, 2015"
output: html_document
---


**KNIT YOUR DOCUMENT AS *HTML* AND SUBMIT IT AND THE `Rmd` file.** 
 

## Classification Metrics Functions 

Write functions of `y` and `y_hat` to calculate the following classification metrics

* True Positive Rate  
* False Positive Rate
* True Negative Rate  
* False Negative Rate 
* Sensitivity 
* Specificity 
* Recall 
* Precision
* Prevalence 
* Accuracy
* Kappa

```{r "definitions"}
library(dplyr)

# true positive rate = TP / TP + FN
tpr <- function(x){
      TP <- x %>% filter(y == "TRUE") %>% filter(y_hat == "TRUE") %>% count()
      FN <- x %>% filter(y == "TRUE") %>% filter(y_hat == "FALSE") %>% count()
      tpr_calc <- TP / (TP + FN)
      return(tpr_calc)
}


######## test bench

# TRUE POSITIVE
flights_clean %>% filter(late == "TRUE") %>% filter(predict == "TRUE") %>% count()

# FALSE NEGATIVE
flights_clean %>% filter(late == "TRUE") %>% filter(predict == "FALSE") %>% count()

TP2 <- flights_clean %>% filter(late == "TRUE") %>% filter(predict == "TRUE") %>% count()
FN2 <- flights_clean %>% filter(late == "TRUE") %>% filter(predict == "FALSE") %>% count()

trp2 <- TP / (TP + FN)
print(trp2)
flights_clean %>% filter(late == "TRUE") %>% count()

flights_clean %>% filter(late == "TRUE") %>% filter(predict == "TRUE") %>% count()
  count(predict == "TRUE")

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


## Usage 

Use the function(s) above to calculate the metrics for your late arrival model that
you created last week. 
```{r "model"}
library(dplyr)

flights <- tbl_df(read_csv("flights_clean.csv", col_names = TRUE))
model <- glm(formula = late ~ dep_delay + month.x + air_time + distance + carrier, family = binomial(), data = flights)
summary(model)
preds <- predict(model, flights, type="response")
qplot(preds, bins = 30)
errs <- (preds - (flights$late == "TRUE"))
errs %>% qplot()
flights$pred <- predict(model, flights, type="response")
flights$predict <- "FALSE"
flights$predict[flights$pred >= .5] <- "TRUE" 
  
flights_clean <- flights %>% select(late, predict)
names(flights_clean)[names(flights_clean) == "late"] <- "y"
names(flights_clean)[names(flights_clean) == "predict"] <- "y_hat"  
```
```{r "evaluations"}
# calculate the true positive rate
tpr(flights_clean)

```

